name: review-pr
description: Generate structured PR review comments with AI analysis and post them to GitHub
version: 1.0.0
author: sellak

# Usage: /review-pr <pr-number> [--dry-run]
# Example: /review-pr 180
# Example: /review-pr 180 --dry-run

command:
  script: |
    python ${SKILL_DIR}/review-pr.py ${pr_number} ${dry_run:+--dry-run}

parameters:
  - name: pr_number
    type: integer
    required: true
    description: Pull request number to review

  - name: dry_run
    type: boolean
    required: false
    default: false
    description: Preview comments without posting

capabilities:
  - github_api
  - file_write
  - file_read

dependencies:
  - gh (GitHub CLI)
  - python3
  - PyYAML

workflow:
  - name: Fetch PR details
    description: Get PR information using GitHub CLI

  - name: Analyze PR
    description: Review files, changes, and generate structured comments

  - name: Generate comments YAML
    description: Create editable review comments file

  - name: User review
    description: Allow user to edit generated comments

  - name: Post to GitHub
    description: Post approved comments to the PR

config:
  output_dir: /tmp/pr-reviews

  default_severity_levels:
    - blocking
    - high
    - medium
    - low
    - info

  # Engineering principles for code review
  engineering_principles:
    architecture:
      - .NET architect patterns
      - Azure CLI (az cli) alignment and conventions
      - Cross-platform compatibility (Windows, Linux, macOS)

    design_patterns:
      - KISS (Keep It Simple, Stupid)
      - DRY (Don't Repeat Yourself)
      - SOLID principles
      - YAGNI (You Aren't Gonna Need It)
      - One class per file
      - Single Responsibility Principle

    testing:
      - Framework: xUnit, FluentAssertions, NSubstitute
      - Quality over quantity
      - Test critical paths and edge cases
      - Mock external dependencies
      - CLI MUST be reliable

    code_quality:
      - Reuse functions across commands
      - No large files (>500 additions)
      - Minimal changes to problem at hand
      - No special characters or emojis in logs/output
      - Client-facing help and error messages must be clear
      - Self-documenting code preferred

    review_standards:
      - Catch issues during review
      - Cautious about deleting work
      - No hallucinations - verify before suggesting
      - Critically review all changes
      - Follow above principles ALWAYS

  review_focus_areas:
    - security
    - testing
    - cross_platform_compatibility
    - design_patterns
    - code_quality
    - error_handling
    - documentation

  auto_checks:
    - name: missing_tests
      severity: blocking
      message: No test files found - violates reliability principle
      framework: xUnit, FluentAssertions, NSubstitute

    - name: hardcoded_secrets
      severity: blocking
      message: Potential secrets - use environment variables or Key Vault

    - name: large_files
      severity: high
      message: Files over 500 lines - violates KISS and SRP
      threshold: 500

    - name: cross_platform_paths
      severity: medium
      message: Check for hardcoded paths - use Path.Combine or os.path.join

    - name: unnecessary_docs
      severity: low
      message: Avoid creating unnecessary documentation files

    - name: special_characters
      severity: low
      message: No emojis or special characters in logs/output
